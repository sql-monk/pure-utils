{
    "sourceFile": "util/Functions/modulesRecureSearchForOccurrences.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1758022025147,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758024321015,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,24 @@\n+/*\r\n+# Description\r\n+Рекурсивно шукає всі входження заданого рядка у визначеннях модулів бази даних.\r\n+\r\n+# Parameters\r\n+@searchFor NVARCHAR(64) - рядок для пошуку\r\n+@options TINYINT - опції пошуку (зарезервовано для майбутнього використання)\r\n+\r\n+# Returns\r\n+TABLE - Повертає таблицю з колонками:\r\n+- object_id INT - ідентифікатор об'єкта\r\n+- occurrencePosition INT - позиція входження\r\n+\r\n+# Usage\r\n+-- Знайти всі входження слова 'SELECT' в модулях\r\n+SELECT * FROM util.modulesRecureSearchForOccurrences('SELECT', 0);\r\n+\r\n+-- Пошук специфічного тексту\r\n+SELECT * FROM util.modulesRecureSearchForOccurrences('BEGIN TRANSACTION', 0);\r\n+*/\r\n CREATE FUNCTION [util].[modulesRecureSearchForOccurrences](@searchFor NVARCHAR(64), @options TINYINT)\r\n RETURNS TABLE\r\n AS\r\n RETURN(\r\n"
                }
            ],
            "date": 1758022025147,
            "name": "Commit-0",
            "content": "CREATE FUNCTION [util].[modulesRecureSearchForOccurrences](@searchFor NVARCHAR(64), @options TINYINT)\r\nRETURNS TABLE\r\nAS\r\nRETURN(\r\nWITH cteoccurrences\r\nAS (SELECT\r\n\t\t\tm.object_id,\r\n\t\t\tCHARINDEX (@searchFor, m.definition) occurrencePosition,\r\n\t\t\tm.definition\r\n\t\tFROM\tsys.sql_modules m (NOLOCK)\r\n\t\tWHERE m.definition IS NOT NULL\r\n\t\tUNION ALL\r\n\t\tSELECT\r\n\t\t\tm.object_id,\r\n\t\t\tCHARINDEX (@searchFor, m.definition, m.occurrencePosition + 1) occurrencePosition,\r\n\t\t\tm.definition\r\n\t\tFROM\tcteoccurrences m\r\n\t\tWHERE m.occurrencePosition > 0),\r\ncteoccurrencesNextChars\r\nAS (SELECT\r\n\t\t\to.object_id,\r\n\t\t\to.occurrencePosition,\r\n\t\t\tSUBSTRING (o.definition, o.occurrencePosition - 1, 1) prevChar,\r\n\t\t\tSUBSTRING (o.definition, o.occurrencePosition + LEN (@searchFor), 1) nextChar,\r\n\t\t\tIIF(@options & 2 = 2, SUBSTRING (o.definition, o.occurrencePosition + LEN (@searchFor), 2), '') nextTwoChars\r\n\t\tFROM\tcteoccurrences o\r\n\t\tWHERE o.occurrencePosition > 0)\r\nSELECT\r\n\tc.object_id,\r\n\tc.occurrencePosition\r\nFROM cteoccurrencesNextChars c\r\nWHERE NOT(@options & 2 = 2 \tAND (c.nextChar = '.' OR c.nextTwoChars = '].')) --skep before '.' option is set but next is '.' or two next = '].'\r\n\tAND NOT(@options & 4 = 4  AND (c.prevChar LIKE '[A-я]' OR c.nextChar LIKE '[A-я]')) --single word opion and prev or next char is a letter \r\n\tAND NOT (@options & 8 = 8 AND  (c.prevChar = '[' OR c.nextChar= ']')) --skip quotename is set, but here we are\r\n);\r\nGO\r\n\r\n"
        }
    ]
}