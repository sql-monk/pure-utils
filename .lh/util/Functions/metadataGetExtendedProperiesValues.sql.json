{
    "sourceFile": "util/Functions/metadataGetExtendedProperiesValues.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1757961370472,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1757961523094,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n \t\tep.name propertyName,\r\n \t\tCONVERT(NVARCHAR(MAX), ep.value) propertyValue,\r\n \t\tCASE\r\n \t\t\tWHEN ep.class = 1 AND ep.minor_id = 0 THEN util.metadataGetObjectType(ep.major_id)\r\n-\t\t\tELSE util.metadataGetAnyType(ep.class)\r\n+\t\t\tELSE util.metadataGetTypeName(ep.class)\r\n \t\tEND typeDesc\r\n \tFROM sys.extended_properties ep (NOLOCK)\r\n \t\tOUTER APPLY(SELECT o.type_desc FROM sys.objects o (NOLOCK) WHERE ep.major_id = o.object_id) objs\r\n \t\tOUTER APPLY(SELECT p.name FROM sys.parameters p (NOLOCK) WHERE ep.major_id = p.object_id AND ep.minor_id = p.parameter_id) params\r\n"
                },
                {
                    "date": 1757961588342,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n \t\tep.name propertyName,\r\n \t\tCONVERT(NVARCHAR(MAX), ep.value) propertyValue,\r\n \t\tCASE\r\n \t\t\tWHEN ep.class = 1 AND ep.minor_id = 0 THEN util.metadataGetObjectType(ep.major_id)\r\n-\t\t\tELSE util.metadataGetTypeName(ep.class)\r\n+\t\t\tELSE util.metadataGetClassName(ep.class)\r\n \t\tEND typeDesc\r\n \tFROM sys.extended_properties ep (NOLOCK)\r\n \t\tOUTER APPLY(SELECT o.type_desc FROM sys.objects o (NOLOCK) WHERE ep.major_id = o.object_id) objs\r\n \t\tOUTER APPLY(SELECT p.name FROM sys.parameters p (NOLOCK) WHERE ep.major_id = p.object_id AND ep.minor_id = p.parameter_id) params\r\n"
                },
                {
                    "date": 1757963005460,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,13 +8,13 @@\n \t\tutil.metadataGetAnyName(ep.major_id, ep.minor_id, ep.class) name,\r\n \t\tep.name propertyName,\r\n \t\tCONVERT(NVARCHAR(MAX), ep.value) propertyValue,\r\n \t\tCASE\r\n-\t\t\tWHEN ep.class = 1 AND ep.minor_id = 0 THEN util.metadataGetObjectType(ep.major_id)\r\n+\t\t\tWHEN ep.class = 1 AND ep.minor_id = 0 THEN objs.objectType\r\n \t\t\tELSE util.metadataGetClassName(ep.class)\r\n \t\tEND typeDesc\r\n \tFROM sys.extended_properties ep (NOLOCK)\r\n-\t\tOUTER APPLY(SELECT o.type_desc FROM sys.objects o (NOLOCK) WHERE ep.major_id = o.object_id) objs\r\n+\t\tOUTER APPLY metadataGetObjectsType(ep.major_id) objs\r\n \t\tOUTER APPLY(SELECT p.name FROM sys.parameters p (NOLOCK) WHERE ep.major_id = p.object_id AND ep.minor_id = p.parameter_id) params\r\n \t\tOUTER APPLY(SELECT c.name FROM sys.columns c (NOLOCK) WHERE ep.major_id = c.object_id AND ep.minor_id = c.column_id) cols\r\n \t\tOUTER APPLY(SELECT ix.name FROM sys.indexes ix (NOLOCK) WHERE ep.major_id = ix.object_id AND ep.minor_id = ix.index_id) idx\r\n \t\tOUTER APPLY(SELECT pf.name FROM sys.partition_functions pf (NOLOCK) WHERE ep.major_id = pf.function_id) partfunc\r\n"
                },
                {
                    "date": 1758024321008,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,30 @@\n-CREATE FUNCTION [util].[metadataGetExtendedProperiesValues](@majorId INT = NULL, @minorId SMALLINT = NULL, @property NVARCHAR(128) = NULL)\r\n+/*\r\n+# Description\r\n+Отримує значення розширених властивостей (extended properties) для об'єктів бази даних.\r\n+Дозволяє фільтрувати по об'єктах та типах властивостей.\r\n+\r\n+# Parameters\r\n+@major NVARCHAR(128) = NULL - основний об'єкт для пошуку (NULL = всі)\r\n+@minor NVARCHAR(128) = NULL - додатковий об'єкт (NULL = всі)\r\n+@property NVARCHAR(128) = NULL - назва властивості (NULL = всі властивості)\r\n+\r\n+# Returns\r\n+TABLE - Повертає таблицю з колонками:\r\n+- majorName NVARCHAR(128) - назва основного об'єкта\r\n+- minorName NVARCHAR(128) - назва додаткового об'єкта\r\n+- propertyName NVARCHAR(128) - назва властивості\r\n+- propertyValue NVARCHAR(MAX) - значення властивості\r\n+- class TINYINT - клас об'єкта\r\n+\r\n+# Usage\r\n+-- Отримати всі розширені властивості для таблиці\r\n+SELECT * FROM util.metadataGetExtendedProperiesValues('myTable', NULL, NULL);\r\n+\r\n+-- Отримати значення конкретної властивості\r\n+SELECT * FROM util.metadataGetExtendedProperiesValues('myTable', 'myColumn', 'MS_Description');\r\n+*/\r\n+CREATE FUNCTION util.metadataGetExtendedProperiesValues(@major NVARCHAR(128) = NULL, @minor NVARCHAR(128) = NULL, @property NVARCHAR(128) = NULL)\r\n RETURNS TABLE\r\n AS\r\n RETURN(\r\n \tSELECT\r\n@@ -8,17 +33,22 @@\n \t\tutil.metadataGetAnyName(ep.major_id, ep.minor_id, ep.class) name,\r\n \t\tep.name propertyName,\r\n \t\tCONVERT(NVARCHAR(MAX), ep.value) propertyValue,\r\n \t\tCASE\r\n-\t\t\tWHEN ep.class = 1 AND ep.minor_id = 0 THEN objs.objectType\r\n+\t\t\tWHEN ep.class = 1 AND ep.minor_id = 0 THEN util.metadataGetObjectType(ep.major_id)\r\n+\t\t\tWHEN ep.class = 1 AND ep.minor_id > 0 THEN 'COLUMN'\r\n \t\t\tELSE util.metadataGetClassName(ep.class)\r\n \t\tEND typeDesc\r\n-\tFROM sys.extended_properties ep (NOLOCK)\r\n-\t\tOUTER APPLY metadataGetObjectsType(ep.major_id) objs\r\n-\t\tOUTER APPLY(SELECT p.name FROM sys.parameters p (NOLOCK) WHERE ep.major_id = p.object_id AND ep.minor_id = p.parameter_id) params\r\n-\t\tOUTER APPLY(SELECT c.name FROM sys.columns c (NOLOCK) WHERE ep.major_id = c.object_id AND ep.minor_id = c.column_id) cols\r\n-\t\tOUTER APPLY(SELECT ix.name FROM sys.indexes ix (NOLOCK) WHERE ep.major_id = ix.object_id AND ep.minor_id = ix.index_id) idx\r\n-\t\tOUTER APPLY(SELECT pf.name FROM sys.partition_functions pf (NOLOCK) WHERE ep.major_id = pf.function_id) partfunc\r\n-\tWHERE ISNULL(@majorId, ep.major_id) = ep.major_id \r\n-\t\tAND ISNULL(@minorId, ep.minor_id) = ep.minor_id\r\n-\t\tAND ISNULL(@property, ep.name) = ep.name\r\n+\tFROM sys.extended_properties ep(NOLOCK)\r\n+\tWHERE\r\n+\t\t(@property IS NULL OR ep.name = @property)\r\n+\t\tAND (@major IS NULL OR ep.major_id = ISNULL(TRY_CONVERT(INT, @major), OBJECT_ID(@major)))\r\n+\t\tAND (\r\n+\t\t\t@minor IS NULL OR ep.minor_id = ISNULL(TRY_CONVERT(INT, @minor),\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCASE ep.class\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 1 THEN util.metadataGetColumnId(ep.major_id, @minor)\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 2 THEN util.metadataGetIndexId(ep.major_id, @minor)\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 7 THEN util.metadataGetParameterId(ep.major_id, @minor)\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEND\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n+\t\t)\r\n );\n\\ No newline at end of file\n"
                }
            ],
            "date": 1757961370472,
            "name": "Commit-0",
            "content": "CREATE FUNCTION [util].[metadataGetExtendedProperiesValues](@majorId INT = NULL, @minorId SMALLINT = NULL, @property NVARCHAR(128) = NULL)\r\nRETURNS TABLE\r\nAS\r\nRETURN(\r\n\tSELECT\r\n\t\tep.major_id Id,\r\n\t\tep.class,\r\n\t\tutil.metadataGetAnyName(ep.major_id, ep.minor_id, ep.class) name,\r\n\t\tep.name propertyName,\r\n\t\tCONVERT(NVARCHAR(MAX), ep.value) propertyValue,\r\n\t\tCASE\r\n\t\t\tWHEN ep.class = 1 AND ep.minor_id = 0 THEN util.metadataGetObjectType(ep.major_id)\r\n\t\t\tELSE util.metadataGetAnyType(ep.class)\r\n\t\tEND typeDesc\r\n\tFROM sys.extended_properties ep (NOLOCK)\r\n\t\tOUTER APPLY(SELECT o.type_desc FROM sys.objects o (NOLOCK) WHERE ep.major_id = o.object_id) objs\r\n\t\tOUTER APPLY(SELECT p.name FROM sys.parameters p (NOLOCK) WHERE ep.major_id = p.object_id AND ep.minor_id = p.parameter_id) params\r\n\t\tOUTER APPLY(SELECT c.name FROM sys.columns c (NOLOCK) WHERE ep.major_id = c.object_id AND ep.minor_id = c.column_id) cols\r\n\t\tOUTER APPLY(SELECT ix.name FROM sys.indexes ix (NOLOCK) WHERE ep.major_id = ix.object_id AND ep.minor_id = ix.index_id) idx\r\n\t\tOUTER APPLY(SELECT pf.name FROM sys.partition_functions pf (NOLOCK) WHERE ep.major_id = pf.function_id) partfunc\r\n\tWHERE ISNULL(@majorId, ep.major_id) = ep.major_id \r\n\t\tAND ISNULL(@minorId, ep.minor_id) = ep.minor_id\r\n\t\tAND ISNULL(@property, ep.name) = ep.name\r\n);"
        }
    ]
}