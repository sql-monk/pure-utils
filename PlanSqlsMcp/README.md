# PlanSqlsMcp

MCP (Model Context Protocol) ?????? ??? ????????? SQL Server Execution Plans.

## ????

PlanSqlsMcp - ?? MCP ??????, ???? ????? ?????????? ??? ????????? estimated execution plans ??? SQL ??????? ? ??????? XML. ?????? ??????????? ?????? ?????? ??? SET SHOWPLAN ???????? ?? GO ??????, ????? ????????? ??????? ? ???????? execution plan.

## ????????????????

### ??????????: ShowEstimatedExecutionPlan

**?????????:**
- `query` (string, ????'???????) - SQL ????? ??? ????? ???????? ???????? execution plan

**?? ??????:**
1. ??????? ? ?????? ??? `SET SHOWPLAN_*` ????????? (ON/OFF)
2. ??????? ??? `GO` ?????
3. ????? `SET SHOWPLAN_XML ON` ?? ???????
4. ??????? ?????
5. ????? `SET SHOWPLAN_XML OFF` ? ?????
6. ???????? execution plan ? ??????? XML

## ????????????

### ?????? ???????

```bash
# ? Windows Authentication
PlanSqlsMcp --server localhost --database MyDatabase

# ? SQL Server Authentication
PlanSqlsMcp --server localhost --database MyDatabase --user sa --password YourPassword
```

### ????????? ?????????? ?????

- `-s, --server` - SQL Server (?? ?????????????: localhost)
- `-d, --database` - ???? ????? (?? ?????????????: master)
- `-u, --user` - ?????????? SQL Server (?????? SQL Authentication)
- `-p, --password` - ?????? (???????????????? ? --user)
- `-h, --help` - ???????? ???????

### ??????? ???????????? ????? MCP

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "ShowEstimatedExecutionPlan",
    "arguments": {
      "query": "SELECT * FROM Users WHERE UserId = 123"
    }
  }
}
```

### ??????? ?????? ???? ???? ????????

**??????? ?????:**
```sql
SET SHOWPLAN_XML ON
GO
SELECT * FROM Users WHERE UserId = 123
GO
SET SHOWPLAN_XML OFF
```

**???????? ????? (?? ???? ?????????):**
```sql
SELECT * FROM Users WHERE UserId = 123
```

## ???????? ??????

- **.NET ??????:** 8.0
- **C# ??????:** 12.0
- **??????????:**
  - Microsoft.Data.SqlClient 5.2.2
  - System.Text.Json 9.0.0

## ???????????

- ??????????? ???????? ??????? ??? SHOWPLAN ???????? ?? ????????? ?????????? ???????
- ????????? ?? Windows ??? ? SQL Server Authentication
- Timeout ????????? ???????: 180 ??????
- ???????? ????????? SHOWPLAN_XML ?????? ? ???? ???????
- ???????? JSON ?????? ????????? ?????? MCP ?????????

## ??????? ???????

?????? ???????? ???????? ???????:
- ??? ??????? ????????? ?????? SHOWPLAN_XML ??????????? ???????????
- ??????? ???????????? ? ??????? JSON-RPC error response
- ???????? ????????? ? stderr

## ????????

?????? ???????????? Source Generators ??? ???????????? JSON, ?? ??????????:
- ?????? ??????????????
- ????????? Native AOT
- ??????????? ?????? ???????????? ?????

## ????????

??????? Pure Utils ???????.
